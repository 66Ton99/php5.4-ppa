diff -Nurp orig/Zend/zend_hash.c new/Zend/zend_hash.c
--- orig/Zend/zend_hash.c	2007-02-21 09:22:11.000000000 +0100
+++ new/Zend/zend_hash.c	2007-02-21 09:22:48.000000000 +0100
@@ -141,11 +141,16 @@ ZEND_API int _zend_hash_init(HashTable *
 
 	SET_INCONSISTENT(HT_OK);
 
-	while ((1U << i) < nSize) {
-		i++;
+	if (nSize >= 0x80000000) {
+		/* prevent overflow */
+		ht->nTableSize = 0x80000000;
+	} else {
+		while ((1U << i) < nSize) {
+			i++;
+		}
+		ht->nTableSize = 1 << i;
 	}
 
-	ht->nTableSize = 1 << i;
 	ht->nTableMask = ht->nTableSize - 1;
 	ht->pDestructor = pDestructor;
 	ht->arBuckets = NULL;
