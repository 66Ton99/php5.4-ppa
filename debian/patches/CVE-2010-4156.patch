--- a/ext/mbstring/libmbfl/mbfl/mbfilter.c	2010/03/12 04:55:37	296101
+++ b/ext/mbstring/libmbfl/mbfl/mbfilter.c	2010/11/09 03:23:04	305214
@@ -1397,6 +1397,10 @@
 			start = string->val + from;
 			end   = start + (length & -4);
 		} else if ((encoding->flag & MBFL_ENCTYPE_SBCS)) {
+			if (from + length >= string->len) {
+				length = string->len - from;
+			}
+
 			start = string->val + from;
 			end = start + length;
 		} else if (encoding->mblen_table != NULL) {
